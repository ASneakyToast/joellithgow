class a{constructor(){this.fpsCounter=0,this.frameCount=0,this.lastTime=performance.now(),this.isLowEndDevice=!1,this.criticalMetrics={fps:0,memory:0,loadTime:0},this.init()}init(){this.detectDeviceCapability(),this.optimizeForDevice(),this.setupPerformanceMonitoring(),this.setupIntersectionObserver(),this.setupIdleOptimizations(),this.setupCriticalResourceHints(),this.monitorWebVitals()}detectDeviceCapability(){const i=document.createElement("canvas"),e=i.getContext("webgl")||i.getContext("experimental-webgl"),t={cores:navigator.hardwareConcurrency||1,memory:navigator.deviceMemory||1,connection:navigator.connection?.effectiveType||"4g",webgl:!!e,gpu:e?e.getParameter(e.RENDERER):"unknown"};this.isLowEndDevice=t.cores<=2||t.memory<=2||t.connection==="slow-2g"||t.connection==="2g"||t.connection==="3g",console.log("Device capabilities:",t),console.log("Low-end device detected:",this.isLowEndDevice)}optimizeForDevice(){this.isLowEndDevice&&(document.documentElement.style.setProperty("--animation-duration","0.1s"),document.documentElement.style.setProperty("--animation-intensity","0.5"),document.querySelectorAll(".floating-element").forEach(e=>{e.style.willChange="auto",e.style.transform="none"}),document.documentElement.style.setProperty("--gradient-complexity","simple"))}setupPerformanceMonitoring(){}setupIntersectionObserver(){const i=new IntersectionObserver(t=>{t.forEach(o=>{const s=o.target;o.isIntersecting?(s.classList.remove("out-of-view"),s.style.animationPlayState="running"):(s.classList.add("out-of-view"),s.style.animationPlayState="paused")})},{rootMargin:"50px",threshold:.1});document.querySelectorAll(".floating-element, .project-card, .skill-item, .process-step").forEach(t=>{t.classList.add("optimize-visibility"),i.observe(t)})}setupIdleOptimizations(){if("requestIdleCallback"in window){const i=e=>{window.requestIdleCallback(e,{timeout:1e3})};i(()=>{this.optimizeImages()}),i(()=>{this.preloadCriticalResources()}),i(()=>{this.setupLazyLoading()})}else setTimeout(()=>{this.optimizeImages(),this.preloadCriticalResources(),this.setupLazyLoading()},1e3)}optimizeImages(){document.querySelectorAll("img").forEach(e=>{if(e.hasAttribute("loading")||e.setAttribute("loading","lazy"),e.hasAttribute("decoding")||e.setAttribute("decoding","async"),this.isLowEndDevice){const t=e.getAttribute("src");t&&t.includes("low-quality")}})}preloadCriticalResources(){["/assets/css/themes.css"].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as=e.endsWith(".css")?"style":"script",t.href=e,document.head.appendChild(t)})}setupLazyLoading(){if("IntersectionObserver"in window){const i=new IntersectionObserver(e=>{e.forEach(t=>{if(t.isIntersecting){const o=t.target;if(o.hasAttribute("data-lazy-init")){const s=o.getAttribute("data-lazy-init");if(s)try{new Function(s)()}catch(n){console.warn("Lazy initialization failed:",n)}}i.unobserve(o)}})},{rootMargin:"200px"});document.querySelectorAll("[data-lazy-init]").forEach(e=>{i.observe(e)})}}setupCriticalResourceHints(){[{rel:"dns-prefetch",href:"//fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:!0}].forEach(e=>{const t=document.createElement("link");t.rel=e.rel,t.href=e.href,e.crossorigin&&(t.crossOrigin="anonymous"),document.head.appendChild(t)})}monitorWebVitals(){if("PerformanceObserver"in window)try{new PerformanceObserver(o=>{const s=o.getEntries(),n=s[s.length-1];console.log("LCP:",n.startTime),n.startTime>2500&&console.warn("LCP is slow:",n.startTime)}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(o=>{o.getEntries().forEach(n=>{console.log("FID:",n.processingStart-n.startTime),n.processingStart-n.startTime>100&&console.warn("FID is slow:",n.processingStart-n.startTime)})}).observe({entryTypes:["first-input"]}),new PerformanceObserver(o=>{let s=0;o.getEntries().forEach(n=>{n.hadRecentInput||(s+=n.value)}),s>.1&&console.warn("CLS is high:",s)}).observe({entryTypes:["layout-shift"]})}catch{console.log("Web Vitals monitoring not available")}}optimize(){this.optimizeForDevice(),this.optimizeImages(),"gc"in window&&typeof window.gc=="function"&&window.gc()}getMetrics(){return{...this.criticalMetrics,isLowEndDevice:this.isLowEndDevice,timestamp:Date.now()}}}const c=new a;window.performanceOptimizer=c;window.addEventListener("beforeunload",()=>{c.getMetrics()});document.addEventListener("visibilitychange",()=>{document.hidden?document.querySelectorAll(".floating-element").forEach(r=>{r.style.animationPlayState="paused"}):document.querySelectorAll(".floating-element").forEach(r=>{r.style.animationPlayState="running"})});
